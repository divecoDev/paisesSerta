<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Redirigiendo...</title>
    
    <style>
        /* Ocultamos todo para que el usuario no vea parpadeos */
        html { visibility: hidden; opacity: 0; }
    </style>

    <script>
    (function() {
        // 1. SEGURIDAD: Forzar HTTPS
        if (window.location.protocol === 'http:' && window.location.hostname !== 'localhost') {
            window.location.replace('https://' + window.location.host + window.location.pathname + window.location.search);
            return;
        }

        // 2. CONFIGURACIÓN: Base URL
        const baseUrl = 'https://sertacentroamerica.com';
        
        // Mapeo: Código ISO (API) -> Tu ruta específica en Serta
        const countryRoutes = {
            'GT': '/guatemala',
            'SV': '/salvador',
            'HN': '/honduras',
            'NI': '/nicaragua',
            'CR': '/costarica/' // Mantenemos el slash final que tenías en tu código original
        };

        // Función de redirección optimizada
        function doRedirect(path) {
            const targetUrl = baseUrl + path + window.location.search;
            
            // Verificamos no estar ya en esa URL para evitar bucles
            if (!window.location.href.includes(targetUrl) && !window.location.pathname.startsWith(path)) {
                try {
                    window.location.replace(targetUrl);
                } catch (e) {
                    window.location.href = targetUrl;
                }
            }
        }

        async function init() {
            // Timeout de 2.5s
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 2500);

            try {
                const response = await fetch('https://ipapi.co/json/', { signal: controller.signal });
                clearTimeout(timeoutId);

                if (!response.ok) throw new Error('API Error');

                const data = await response.json();
                const countryCode = data.country_code;

                // Lógica de enrutamiento
                if (countryRoutes[countryCode]) {
                    doRedirect(countryRoutes[countryCode]);
                } else {
                    // DEFAULT: Si es de otro país (USA, MX, PA, etc.), mandar a Guatemala
                    doRedirect('/guatemala');
                }

            } catch (error) {
                // FALLBACK: Si falla la API o hay timeout, mandar a Guatemala
                console.warn("Fallo en detección, redirigiendo a Default (GT)");
                doRedirect('/guatemala');
            }
        }

        init();
    })();
    </script>
</head>
<body>
    </body>
</html>
